# EC2 Instance Storage

<br>

## EBS : Elastic Block Store

- 인스턴스가 실행 중인 동안 연결 가능한 네트워크 드라이브
- EBS 볼륨을 사용하면 인스턴스가 종료된 후에도 데이터를 지속할 수 있따
- CCP 레벨에서는 한 인스턴스당 하나만 마운트될 수 있다
    - CCP ?
- 특정 가용 영역에서만 가능

<br>

### EBS Volume

- 물리적이지 않은 네트워크 드라이브
    - 인스턴스와 EBS 볼륨이 서로 통신을 하기 위해서는 네트워크를 필요로 한다
    - 네트워크가 사용되기 때문에 컴퓨터가 다른 서버에 도달할 때 지연이 생길 수 있다.
- 특정 가용 영역에 고정되어 있으므로 다른 가용 영역로 옮길 수 없다 → 스냅샷을 이용하여 옮기면 되긴 함
- 용량을 미리 결정해야 한다
    - 원하는 양의 GB 및 IOPS(단위 초당 전송 수)를 미리 지정
- **Delete on Termination attribute : 종료 시 삭제**
    - EC2 인스턴스를 통해 EBS 볼륨을 생성하는 경우 종료 시 삭제할 수 있는 속성이 존재

<br>

### EBS Snapshots

- 언제든 원하는 시점에 EBS 볼륨을 가져와서 백업을 만든다
- 추후 EBS 볼륨을 삭제하더라도 해당 시점에 대한 백업으로 복원할 수 있는 것
- **스냅샷 생성 이유**
    - 복원
    - 가용 영역(AZ) 또는 리전(Region)에 걸친 스냅샷을 복사할 수 있기 때문


---


<br>

# AMI : Amazon Machine Image

<br>

- 사용자 지정 EC2 인스턴스
- AWS에서 만든 AMI를 사용하거나 사용자 지정 AMI를 만들 수도 있다
- 각자의 소프트웨어 구성에 대해 운영체제를 정의 및 설정
- 모니터링 도구를 설정할 수도 있다
- 자체적으로 AMI를 생성하면 부팅과구성에 시간이 단축될 수 있다
    - 설치를 필요로 하는 소프트웨어들이 AMI를 통해서 사전에 패키징되기 때문
    - AMI 자체 구성으로 특정 리전에 맞게 구축하며 원하는 리전에 복사하거나 활용할 수 있다


<br>

---

<br>

### EC2 Instance Store

- 높은 성능이 요구된다면 EC2 인스턴스에 연결된 하드웨어 디스크 성능이 향상되어야 한다
- EC2 인스턴스 스토어 : 서버에 물리적으로 연결된 디스크 공간(하드웨어 드라이브)
- I/O 성능 향상을 위해 활용할 수 있다
- 단, EC2 인스턴스 스토어를 중지 또는 종료한다면 해당 스토리지 또한 손실된다
- EC2 인스턴스 스토어는 임시 스토리지라고 불리며 장기적으로 데이터를 보관할 만한 장소는 될 수 없다
- 용도 : 버퍼, 캐시, 스크래치 데이터 또는 임시 콘텐츠로 사용
    - 장기 스토리지로써는 EBS가 적합

## EBS 볼륨 타입

- gp2/gp3 : 범용 SSD 볼륨. 다양한 워크로드에 대해 가성비 절충안
- io1/io2 : 최고 성능을 자랑하는 SSD 볼륨, 지연시간 낮고 대용량의 워크로드에 사용
- st1 : 저비용 HDD. 잦은 접근과 처리량이 많은 워크로드에 사용
- sc1 : 가장 비용이 적게 드는 HDD 볼륨, 접근 빈도가 낮은 워크로드를 위해 설계

**EBS 볼륨 정의 속성**

크기, 처리량, IOPS(초당 IO 작업수)

gp2/gp3,  io1/io2 은 부팅 볼륨으로 사용될 수 있으며 루트 OS가 실행될 위치에 해당한다


## EBS Encryption

- 암호화된 EBS 볼륨을 생성할 때 얻는 것
    - 볼륨 내에서 암호화된 저장 데이터를 가져온다
    - 인스턴스와 볼륨 간에 전송되는 모든 데이터는 암호화된다
    - 모든 스냅샷은 암호화 된다
    - 스냅샷에서 생성된 모든 볼륨은 암호화된다
- 기존 암호화와 해독 메커니즘 작업이 뒷단에서 EC2와 EBS에서 처리된다
- 암호화는 지연 시간에 미치는 영향도 거의 없으며, KMS(AES-256)키를 활용
- **암호화되지 않은 EBS 볼륨을 암호화 하는 방법**
    - 볼륨의 EBS 스냅샷을 생성
    - 복사를 통해 EBS 스냅샷 생성
    - 스냅샷에서 새 EBS 볼륨을 생성하면 해당 볼륨도 암호화되게 된다
    - 암호화된 볼륨을 원본 인스턴스에 연결 가능


<br>

## EFS : Elastic File System

- 다양한 가용영역에 걸쳐 다수의 EC2 인스턴스에 마운트 할 수 있는 관리형 NFS(Network File System )
- 다중 AZ에서 동작
    - EBS는 단일 가용 영역에 묶여 있다
- 가용성, 확장성이 좋으며 쓴 만큼 내기에 비용이 많이 든다
    - 적은 데이터를 저장한다면 오히려 적게 낸다
- EFS에 보안그룹을 연결해서 입력량과 연결을 관리
    - 다중 AZ에 걸쳐 여러 EC2 인스턴스가 있다는 뜻
- 용도 : 콘텐츠 관리, 웹사이트 데이터 공유, wordPress
- 표준 NFSv4.1 프로토콜 사용 → 네트워크 드라이브 마운트 시 기본 방법
- Linux 기반(POSIX 파일 시스템) AMI에서만 작동
- **옵션**
    - #Scale : 높은 동시성과 처리량, 페타바이트까지 확장 가능 (자동 수행)
    - #Performance mode
        - General purpose 모드 : 웹 서버 운영이나 지연 시간에 민감한 파일이 존재하는 경우 범용 성능 모드 사용
        - Max I/O 성능 모드 : 지연 시간은 더 길겠지만 처리량이 더 향상. 빅데이터 & 미디어 처리
        - Throughput 모드 : Bursting 처리량 모드로 기본 설정, 1TB 스토리지에 초당 50mb를 저장 가능하며 100MB까지 확장 가능
        - Provisioned  모드 : EFS 크기는 줄이면서 처리량을 높이기 위함
    - #Storage Tiers 스토리지 계층 : 파일에 대한 수명 주기 관리 기능. 30일이 지난 후 새로운 계층으로 파일을 이동시키는 기능

