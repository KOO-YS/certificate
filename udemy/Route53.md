# Route 53

## DNS 란?

- Domain Name System
- 호스트 이름, url 을 대상 서버 **IP 주소로 번역**
- 계층적 이름 구조를 가지고 있다

### DNS Terminologies : 관련 용어

- Domain Registrar : 도메인 이름을 등록하는 곳 (→ route 53)
- DNS Recoreds :
- Zone file : DNS 레코드를 포함. 호스트 이름과 IP, 주소를 일치시키는 방법
- Name Server : DNS 쿼리를 실제로 해결하는 서버
- Top Level Domain(TLD) : com, us, in, gov, org
- Second Level Domain(SLD) : amazon.com, google.com
- Root (마지막 점) → TLD → SLD → Sub Domain → Domain Name → Protocol

### DNS 동작 방법

- 공인 IP 가 하나 있을 때, 도메인 이름으로 접근을 시도
    - 원하는 도메인 이름을 가지고 DNS 서버를 등록해야 한다
1. 사용자가 웹 브라우저에 도메인 이름을 가지고 접근을 시도
2. Local DNS Server에 도메인 이름을 검색
3. Local Server가 이 쿼리를 본적이 없다면, **(ICANN에 의해 관리되는 )DNS 서버의 루트**에 검색
    1. 루트 DNS 서버는 TLD부터 검색 → 만약 (예시)com을 안다면 해당 이름 서버 레코드를 알려줌
    2. **(IANA에 의해 관리되는 )TLD DNS Server**(예 : com 도메인 서버)에게 쿼리의 답을 요청
4. 해당 서버를 알고 있다면 ip를 전달
5. 최종, 서브 도메인(SLD) DNS 서버는 해당 주소 항목을 결과로 보냄
6. 차례로 물어본 결과로 웹 서버를 얻을 수 있고, 앞으로 다시 같은 주소를 물어본다면 바로 답변 가능

<br>

# Amazon Route 53

- 고가용성, 확장성을 가진, 완전히 관리되며 권한있는 DNS
    - 권한이 있다 →사용자가 DNS 레코드를 업데이트 할 수 있다
- 도메인 레지스트라 → 도메인 이름을 등록 가능
- 리소스 관련 상태 확인 가능
- 100% SLA 가용성을 제공하는 유일한 AWS 서비스
- 53란 ? DNS 서비스, 이름에서 사용되는 전통적인 DNS 포트

<br>

### Route 53 - Records

- Route 53에서 여러 DNS 레코드를 정의하고 레코드를 통해 특정 도메인으로 라우팅하는 방법 정의
- 각 레코드는 도메인, 서브 도메인 이름 정보를 포함
- **레코드 종류 : A, AAAA, CNAME, NS**
- 레코드의 값 : 123.456.789.123
- 라우팅 정책 : route 53이 쿼리에 응답하는 방식
- TTL : DNS가 resolver에서 레코드가 캐싱되는 시간

<br>


### Route 53 - Record Types

- A : IPv4와 호스트 이름을 매핑
- AAAA : IPv6와 호스트 이름을 매핑
- CNAME : 호스트 이름을 다른 호스트 이름과 매핑
    - 대상 호스트 이름은 A, AAAA에 포함된 호스트 이름일지도..
    - DNS 이름공간 또는 Zone Apex의 상위 노드에 대한 CNAMES를 생성할 수 없다
- NS : 호스팅 존의 이름 서버, 서버의 DNS 이름 또는 IP 주소로 호스팅 존에 대한 DNS 쿼리에 응답 가능. 트래픽이 도메인으로 라우팅 되는 방식을 제어

<br>


### Route 53 - Hosted Zones

- 레코드의 컨테이너
- 도메인과 서브도메인으로 가는 트래픽의 라우팅 방식 정의
- 호스팅 존
    - 퍼블릭 호스팅 존
        - 인터넷에서 라우팅이 트래픽되는 법을 구분하는 레코드를 포함
        - 이름을 살때마다 퍼블릭 호스팅 존을 만들 수 있다
        - 쿼리에 도메인 이름의 IP가 무엇인지 알 수 있다
    - 프라이빗 호스팅 존
        - VPC 내부에서만 라우팅이 트래픽되는지를 구분하는 레코드 포함
        - 공개되지 않는 도메인 이름을 지원
        - 가상 프라이빗 클라우드 (VPC) 만이 url을 리졸브 할 수 있다
    - 각 호스트 존마다 월 $0.50 을 지불해야 한다

<br>

### Public vs Private Hosted Zones

public 

- 공개된 클라이언트로부터 온 쿼리에 응답 가능

private

- 해당 VPC에서만 동작
- 비공개 도메인 이름의 프라이빗 리소스를 식별 가능

<br>

### Route 53 - Records TTL (Time To Live)

- 최초 : 클라이언트가 DNS route 53과 웹 서버에 접속 → DNS로부터 회신
- 회신 내용 : A 레코드 & IP 주소 & TTL
- TTL 시간동안 클라이언트는 결과를 캐시 (TTL 시간동안 재요청을 보내거나 DNS에게 쿼리를 보낼 필요가 없다)
- 이미 저장된 답변을 이용함으로써 웹 서버에 접속이 가능한 HTTP 요청 및 회신을 보낼 수 있음
- TTL 설정
    - TTL 시간을 늘림
        - 트래픽이 적고, 요청을 적게 보냄
        - 클라이언트가 오래된 레코드를 받을 가능성이 있음
    - TTL 시간을 줄임
        - DNS 서버 트래픽 양이 많아져서 비용이 많이 듦
            - Route 53에 들어오는 요청의 양에 따라 요금 책정
        - 오래된 레코드 보관 시간은 짧아짐
<br>

---

<br>

## CNAME 과 별칭의 차이

- 로드밸런서나, 클라우드 프론트 등 AWS의 리소스를 사용하면 AWS 호스트 이름이 노출되는데, **보유한 도메인에 호스트 이름을 매핑하고자 할 경우의 선택지**
1. CNAME
    - 호스트 이름이 다른 호스트 이름으로 향하도록 할 수 있다
    - 루트 도메인 이름이 아닌 경우에만 가능 (서브 이상 도메인이 있어야함)
    - 
2. Alias 
    - Route 53에 한정되지만 호스트 이름이 특정 AWS 리소스로 향하도록 할 수 있음
    - 루트 및 비루트 도메인 모두 작동 가능
    - 무료
    - 자체적으로 상태 확인이 가능
    - 리소스의 IP 주소가 바뀌는 것을 자동 인식
    - CNAME과 달리 탑 노드의 DNS 네임스페이스 (Zone Apex)에 사용될 수 있다
    - AWS 리소스를 위한 별칭 레코드의 타입 → A, AAAA (IPv4, IPv6)
    - 별칭 설정 시 TTL 사용 불가 ( Route 53에 의해 자동 설정)
    - 대상 : ELB, CloudFront 배포, API Gateway, 엘라스틱 빈스톡 환경, S3 웹사이트 (버킷 X), VPC 인터페이스 엔드포인트, Global Accelerator, 동일 호스트 존의 Route 53
    - **EC2 DNS 이름은 별칭 레코드의 대상이 될 수 없다**