# AWS RDS

- SQL을 쿼리 언어로 사용하는 관계형 데이터 베이스 서비스
- AWS에서 관리되는 클라우드 데이터베이스
    - Postgres
    - MySQL
    - MariaDB
    - Oracle
    - Microsoft SQL Server
    - Aurora (AWS proprietary database : AWS가 소유권을 가진 DB)


- **EC2 인스턴스 상에 자체 데이터베이스를 배포하지 않고 RDS를 사용하는 이유는?**
    - 데이터베이스 뿐만 아니라 여러 기타 서비스도 제공하기 때문
        - 데이터베이스 프로비저닝 자동화, OS 패치
        - 지속적인 백업, 특정 타임스탬프로 복구 → 지정시간 복구 (PITR : Point In Time Restore)
        - 모니터링 대시보드
        - 읽기 성능 향상을 목적으로 하는 리플리카
        - 다중 AZ 설정 (재해 복구)
        - 업그레이드를 위한 유지보수
        - EBS를 기반 스토리지
    - RDS 인스턴스는 SSH 접근이 불가

<br>

**RDS 백업**

- 백업 : RDS에서 자동으로  활성화 & 자동 생성
- 정의해 놓은 유지관리 기간 동안 매일 전체 백업
- 매 5분마다 트랜잭션 로그가 RDS에 백업
→ 어떠한 지정 시점으로든 데이터베이스를 복원할 수 있다

- 자동백업은 기본적으로 7일 보관 최대 35일까지 보관 기간 설정 가능

**RDS - Storage Auto Scaling**

- RDS 데이터베이스를 생성할 때는 원하는 스토리지 용량을 지정해야 한다
- 사용 가능한 공간이 부족해지는 경우 스토리지 오토 스케일링이 활성화되어 있다면 RDS가 자동으로 스토리지에 대한 스케일링을 수행
- 스토리지 확장을 위해 데이터베이스를 중단하는 작업을 따로 수행할 필요가 없다
- 최대 스토리지 임계값(Maximum Storage Threshold)을 설정해야 한다
    - 무제한 확장이 불가능하기 때문
- 스토리지 수정
    - 사용 가능한 스토리지가 할당된 스토리지의 10% 미만으로 떨어지거나
    - 이처럼 낮은 스토리지 상태가 5분 이상 지속
    - 6시간 이상 지났을 경우 자동으로 스토리지 수정

<br>

**RDS Read Replicas for read scalability**

- 애플리케이션이 DB 인스턴스에 대해 읽기와 쓰기를 수행하는 도중, 너무 많은 요청을 받으면 읽기를 스케일링
- 읽기 전용 복제봄을 최대 5개까지 생성 가능
- 동일 가용영역 , 리전에 걸쳐서 사용 가능
- 주 RDS DB 인스턴스와 두 읽기 전용 복제본 사이에 비동기식 복제 발생
    - 읽기가 일관적으로 유지된다는 뜻
- 복제본을 읽기 스케일링 뿐만 아니라 DB로 승격시켜 이용도 가능(권환 획득 후) & 자체적인 생애 주기를 가짐
- query의 SELECT 키워드만 사용 가능
- **읽기 전용 복제본에 따른 네트워크 비용**
    - 읽기 전용 복제본은 관리형 서비스
    - 읽기 전용 복제본이 다른 AZ 상이지만 동일한 리전 내에 있다면 비용이 발생하지 않는다

<br>

**RDS Multi AZ (Disaster Recovery : 재해 복구)**

- 다중 AZ는 주로 재해 복구에 사용
- read/write 수행 마스터 DB가 있다면, 동기식으로 다른 AZ에 동기식으로 스탠바이 인스턴스 복제
    - 동기 : 마스터 DB 반영 내역이 스탠바이 인스턴스에도 반영
- 하나의 DNS 이름을 가지고 통신
    - 마스터에 문제가 생기면 스탠바이 DB에 자동으로 장애 조치 수행
- 마스터 인스턴스 또는 스토리지에 장애가 발생할 때 스탠바이가 새로운 마스터가 될 수 있다
- 스탠바이 : 단지 대기 목적, 읽고 쓸 수 없다. 장애 예방
- 단일 AZ에서 다중 AZ로 RDS 전환
    - 다운타임이 전혀 없다 → 중지하지 않는다

```bash
"Read Replicas" vs "Multi AZ" 차이 주의하기
```

<br>

### RDS Security - Encryption

- 사용하지 않는 데이터의 암호화
    - AWS KMS(키 매니지먼트 서비스 → AES 256 사용)로 마스터 DB와 읽기 전용 복제본을 암호화할 수 있다
    - 암호화 실행시 실행 시간을 정의할 필요
    - **마스터 DB를 암호화하지 않으면 복제본도 암호화할 수 없다.**
    - TDE(Transparent Data Encryption) : Oracle과 SQL 서버에서 사용할 수 있는 투명한 데이터 암호화
- 전송되고 있는 데이터의 암호화
    - 클라이언트에서 데이터베이스로 전송중에 SSL 인증서가 필요
    - 모든 클라이언트가 SSL을 사용하도록 하려면
        - PostgreSQL : 콘솔 매개변수 그룹을 설정해야 한다
            
            ```bash
            rds.force_ssl=1
            ```
            
        - MySQL : 명령문을 DB 내부에서 실행
            
            ```bash
            GRANT USAGE ON *.* TO 'mysqluser'@'%' REQUIRE SSL;
            ```
            
- **RDS Encryption 작업**
    - RDS 백업을 암호화하는 방법
        - 암호되지 않은 RDS DB의 스냇샷을 생성하면 스냅샷은 암호화되지 않는다
        - 암호된 RDS DB의 스냇샷을 생성하면 기본적으로 암호화된 스냅샷이 생성되나, 기본 값은 아니다
    - 암호화되지 않은 RDS DB의 암호화 방법
        - 암호화되지 않은 RDS 스냅샷을 생성할 때 암호화가 되지않지만, 스냅샷을 복제하면서 암호화 활성화 선택 가능

<br>

### RDS Security - Network & IAM